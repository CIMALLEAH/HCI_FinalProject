<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PlanEase - Calendar</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Reset & base */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      width: 100%;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
      background-attachment: fixed;
      color: #fff;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      min-height: 100vh;
      overflow: hidden;
    }

    /* Scrollbar styling */
    .app-container::-webkit-scrollbar {
      width: 10px;
    }
    .app-container::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.2);
      margin-top: 80px;
      margin-bottom: 80px;
    }
    .app-container::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #4a9eff, #7e22ce);
      border-radius: 10px;
    }
    .app-container::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #6ab5ff, #9d4edd);
    }

    .app-container {
      width: 100%;
      height: 100vh;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      padding-top: 80px;
      padding-bottom: 80px;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 28px;
      background: rgba(0, 0, 0, 0.22);
      backdrop-filter: blur(8px);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 80px;
      z-index: 1100;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-img {
      width: 48px;
      height: 48px;
      border-radius: 10px;
      overflow: hidden;
    }

    .logo-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .logo-text h1 {
      font-size: 18px;
      letter-spacing: 1px;
      font-weight: bold;
    }

    .logo-text p {
      font-size: 11px;
      opacity: 0.8;
    }

    .header-right {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .notification-btn {
      position: relative;
      cursor: pointer;
      padding: 8px;
      font-size: 18px;
    }

    .notification-dot {
      position: absolute;
      top: 6px;
      right: 6px;
      width: 8px;
      height: 8px;
      background: #ff4444;
      border-radius: 50%;
      display: none;
    }

    .profile-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, 0.15);
      overflow: hidden;
      cursor: pointer;
      position: relative;
    }

    .profile-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Notification panel */
    .notification-panel {
      position: fixed;
      top: 80px;
      right: 28px;
      width: 360px;
      max-width: 90%;
      background: rgba(30, 30, 60, 0.95);
      padding: 16px;
      border-radius: 12px;
      z-index: 1200;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
      max-height: calc(100vh - 160px);
      overflow-y: auto;
      display: none;
    }

    .notification-panel.active {
      display: block;
    }

    .notification-panel h3 {
      font-size: 16px;
      margin-bottom: 10px;
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .notification-item {
      background: rgba(255, 255, 255, 0.06);
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 8px;
      border-left: 3px solid #4a9eff;
    }

    .notification-item.unread {
      background: rgba(74, 158, 255, 0.12);
      border-left-color: #ff9d00;
    }

    /* Content */
    .content {
      padding: 18px 28px;
      padding-bottom: 24px;
    }

    .planner-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .planner-header h1 {
      font-size: 28px;
      font-weight: 600;
    }

    /* Color Legend */
    .color-legend {
      background: rgba(30, 30, 70, 0.5);
      border-radius: 16px;
      padding: 12px 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 16px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }

    .legend-color {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .legend-color.school {
      background: #4a9eff;
    }

    .legend-color.personal {
      background: #9b59b6;
    }

    .legend-color.work {
      background: #1d9a66;
    }

    .legend-color.mixed {
      background: linear-gradient(135deg, #4a9eff 0%, #9b59b6 50%, #1d9a66 100%);
    }

    .legend-color.conflict {
      background: #ff4444;
    }

    /* View Toggle */
    .view-toggle {
      display: flex;
      gap: 8px;
      background: rgba(30, 30, 70, 0.5);
      border-radius: 16px;
      padding: 4px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .view-btn {
      padding: 8px 16px;
      border-radius: 12px;
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.6);
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .view-btn.active {
      background: rgba(74, 158, 255, 0.3);
      color: #fff;
    }

    /* Month navigation */
    .month-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding: 12px 16px;
      background: rgba(30, 30, 70, 0.5);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .nav-btn {
      background: rgba(74, 158, 255, 0.15);
      border: 1px solid rgba(74, 158, 255, 0.3);
      color: #4a9eff;
      padding: 8px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
    }

    .nav-btn:hover {
      background: rgba(74, 158, 255, 0.25);
      transform: scale(1.05);
    }

    .current-month {
      font-size: 18px;
      font-weight: 700;
      text-align: center;
      cursor: pointer;
      padding: 8px 16px;
      border-radius: 10px;
      transition: all 0.3s;
    }

    .current-month:hover {
      background: rgba(74, 158, 255, 0.1);
    }

    /* Month/Year picker modal */
    .picker-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1500;
    }

    .picker-modal.active {
      display: flex;
    }

    .picker-content {
      background: linear-gradient(135deg, #2a3f5f, #1e3c72);
      padding: 24px;
      border-radius: 16px;
      max-width: 400px;
      width: 90%;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
    }

    .picker-content h2 {
      font-size: 20px;
      margin-bottom: 20px;
    }

    .picker-selects {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }

    .picker-selects select {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }

    .picker-selects select option {
      background: #1a1a2e;
      color: #fff;
    }

    .picker-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .picker-btn {
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      transition: all 0.3s;
    }

    .picker-btn.cancel {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
    }

    .picker-btn.cancel:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .picker-btn.confirm {
      background: #4a9eff;
      color: #fff;
    }

    .picker-btn.confirm:hover {
      background: #6ab5ff;
      transform: scale(1.05);
    }

    /* Calendar grid */
    .calendar-grid {
      background: rgba(20, 20, 60, 0.4);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 20px;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-bottom: 12px;
    }

    .weekday {
      text-align: center;
      font-weight: 700;
      opacity: 0.9;
      font-size: 14px;
      padding: 8px 0;
    }

    .days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .day {
      background: rgba(255, 255, 255, 0.02);
      padding: 12px 8px;
      border-radius: 10px;
      min-height: 70px;
      text-align: center;
      transition: all 0.2s;
      cursor: pointer;
      position: relative;
    }

    .day:hover {
      background: rgba(255, 255, 255, 0.05);
      transform: scale(1.02);
    }

    .day.today {
      border: 2px solid #4a9eff;
      background: linear-gradient(180deg, rgba(74, 158, 255, 0.1), rgba(0, 0, 0, 0.12));
    }

    .day.has-events {
      box-shadow: inset 0 -4px 0 rgba(74, 158, 255, 0.4);
    }

    .day.conflict {
      box-shadow: inset 0 -4px 0 rgba(255, 68, 68, 0.6);
    }

    /* Gradient colors for mixed events */
    .day.school-only {
      background: linear-gradient(180deg, rgba(74, 158, 255, 0.15), rgba(255, 255, 255, 0.02));
    }

    .day.personal-only {
      background: linear-gradient(180deg, rgba(155, 89, 182, 0.15), rgba(255, 255, 255, 0.02));
    }

    .day.work-only {
      background: linear-gradient(180deg, rgba(29, 154, 102, 0.15), rgba(255, 255, 255, 0.02));
    }

    .day.school-personal {
      background: linear-gradient(135deg, rgba(74, 158, 255, 0.15), rgba(155, 89, 182, 0.15));
    }

    .day.school-work {
      background: linear-gradient(135deg, rgba(74, 158, 255, 0.15), rgba(29, 154, 102, 0.15));
    }

    .day.personal-work {
      background: linear-gradient(135deg, rgba(155, 89, 182, 0.15), rgba(29, 154, 102, 0.15));
    }

    .day.all-categories {
      background: linear-gradient(135deg, rgba(74, 158, 255, 0.15), rgba(155, 89, 182, 0.15), rgba(29, 154, 102, 0.15));
    }

    /* Section */
    .section {
      background: rgba(30, 30, 70, 0.5);
      border-radius: 24px;
      padding: 20px 18px;
      margin-bottom: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
    }

    .section-header i {
      font-size: 24px;
    }

    .section-header h2 {
      font-size: 22px;
      font-weight: 600;
    }

    .planner-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 400px;
      overflow-y: auto;
      padding-right: 8px;
    }

    .planner-list::-webkit-scrollbar {
      width: 8px;
    }

    .planner-list::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.12);
    }

    .planner-list::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #4a9eff, #7e22ce);
      border-radius: 10px;
    }

    .planner-list::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #6ab5ff, #9d4edd);
    }

    .event-item {
      background: rgba(50, 50, 90, 0.6);
      border-radius: 20px;
      padding: 16px;
      border-left: 5px solid #4a9eff;
      transition: all 0.25s;
    }

    .event-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    .event-item.school {
      border-left-color: #4a9eff;
    }

    .event-item.personal {
      border-left-color: #9b59b6;
    }

    .event-item.work {
      border-left-color: #1d9a66;
    }

    .event-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .event-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .event-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #4a9eff;
      flex-shrink: 0;
    }

    .event-title h3 {
      font-size: 18px;
      font-weight: 600;
    }

    .event-badge {
      background: rgba(74, 158, 255, 0.4);
      padding: 5px 12px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      text-transform: capitalize;
    }

    .event-badge.personal {
      background: rgba(155, 89, 182, 0.4);
    }

    .event-badge.work {
      background: rgba(29, 154, 102, 0.4);
    }

    .event-details p {
      font-size: 14px;
      opacity: 0.85;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .event-time {
      margin-top: 8px;
      font-weight: 500;
      opacity: 1;
    }

    .no-events {
      text-align: center;
      padding: 32px 20px;
      opacity: 0.6;
      font-size: 16px;
    }

    /* Bottom nav */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 80px;
      background: rgba(12, 12, 30, 0.95);
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 10px 0;
      border-top: 1px solid rgba(255, 255, 255, 0.04);
      z-index: 1100;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: rgba(255, 255, 255, 0.6);
      text-decoration: none;
      font-size: 12px;
      transition: all 0.3s;
    }

    .nav-item:hover {
      color: #4a9eff;
    }

    .nav-item.active {
      color: #4a9eff;
    }

    .nav-icon {
      font-size: 20px;
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="header">
      <div class="logo">
        <div class="logo-img">
          <img src="assets/logo.png" alt="PlanEase Logo">
        </div>
        <div class="logo-text">
          <h1>PLAN EASE</h1>
          <p>Plan with Ease</p>
        </div>
      </div>
      <div class="header-right">
        <div class="notification-btn" onclick="toggleNotifications()">
          <i class="fas fa-list"></i>
          <div class="notification-dot" id="notificationDot"></div>
        </div>
        <div class="profile-icon" onclick="window.location.href='account.html'">
          <img src="assets/profile_pic.png" alt="Profile">
        </div>
      </div>
    </div>

    <div class="notification-panel" id="notificationPanel">
      <h3><i class="fas fa-bell"></i> Notifications</h3>
      <div id="notificationList"></div>
    </div>

    <div class="content">
      <div class="planner-header">
        <h1>Calendar</h1>
        <div class="view-toggle">
          <button class="view-btn active" id="monthViewBtn" onclick="switchView('month')">Month</button>
          <button class="view-btn" id="weekViewBtn" onclick="switchView('week')">Week</button>
        </div>
      </div>

      <div class="color-legend">
        <div class="legend-item">
          <div class="legend-color school"></div>
          <span>School</span>
        </div>
        <div class="legend-item">
          <div class="legend-color personal"></div>
          <span>Personal</span>
        </div>
        <div class="legend-item">
          <div class="legend-color work"></div>
          <span>Work</span>
        </div>
        <div class="legend-item">
          <div class="legend-color mixed"></div>
          <span>Mixed</span>
        </div>
        <div class="legend-item">
          <div class="legend-color conflict"></div>
          <span>Conflict</span>
        </div>
      </div>

      <div class="month-nav">
        <button class="nav-btn" onclick="changeView(-1)">
          <i class="fas fa-chevron-left"></i>
        </button>
        <div class="current-month" id="viewLabel" onclick="openMonthPicker()"></div>
        <button class="nav-btn" onclick="changeView(1)">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>

      <div class="calendar-grid">
        <div class="weekdays" id="weekdaysContainer">
          <div class="weekday">Sun</div>
          <div class="weekday">Mon</div>
          <div class="weekday">Tue</div>
          <div class="weekday">Wed</div>
          <div class="weekday">Thu</div>
          <div class="weekday">Fri</div>
          <div class="weekday">Sat</div>
        </div>
        <div class="days" id="calendarDays"></div>
      </div>

      <div class="section">
        <div class="section-header">
          <i class="fas fa-list-alt"></i>
          <h2 id="scheduleTitle">This Month's Schedule</h2>
        </div>
        <div class="planner-list" id="scheduleList"></div>
      </div>
    </div>

    <div class="bottom-nav">
      <a href="home.html" class="nav-item">
        <div class="nav-icon"><i class="fas fa-home"></i></div>
        <div class="nav-label">Home</div>
      </a>
      <a href="calendar.html" class="nav-item active">
        <div class="nav-icon"><i class="far fa-calendar-alt"></i></div>
        <div class="nav-label">Calendar</div>
      </a>
      <a href="planner.html" class="nav-item">
        <div class="nav-icon"><i class="fas fa-book"></i></div>
        <div class="nav-label">Planner</div>
      </a>
      <a href="account.html" class="nav-item">
        <div class="nav-icon"><i class="far fa-user"></i></div>
        <div class="nav-label">Account</div>
      </a>
    </div>
  </div>

  <!-- Month/Year Picker Modal -->
  <div class="picker-modal" id="pickerModal">
    <div class="picker-content">
      <h2>Select Month & Year</h2>
      <div class="picker-selects">
        <select id="monthSelect">
          <option value="0">January</option>
          <option value="1">February</option>
          <option value="2">March</option>
          <option value="3">April</option>
          <option value="4">May</option>
          <option value="5">June</option>
          <option value="6">July</option>
          <option value="7">August</option>
          <option value="8">September</option>
          <option value="9">October</option>
          <option value="10">November</option>
          <option value="11">December</option>
        </select>
        <select id="yearSelect">
          <!-- Populated by JS -->
        </select>
      </div>
      <div class="picker-actions">
        <button class="picker-btn cancel" onclick="closeMonthPicker()">Cancel</button>
        <button class="picker-btn confirm" onclick="confirmMonthPicker()">Confirm</button>
      </div>
    </div>
  </div>

  <script>
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();
    let currentWeekStart = null;
    let viewMode = 'month'; // 'month' or 'week'

    const AppData = {
      user: {
        firstName: 'Damian',
        lastName: 'Alvah',
        email: 'dalvah@gmail.com'
      },
      events: [
        {
          id: 1,
          kind: 'event',
          category: 'school',
          type: 'school',
          title: 'IT 321',
          fullTitle: 'Human-Computer Interaction',
          location: 'Online',
          date: '2025-12-06',
          startDate: '2025-12-06',
          startTime: '10:00',
          endDate: '2025-12-06',
          endTime: '13:30',
          priority: 'medium',
          reminder: '10m',
          completed: false
        },
        {
          id: 2,
          kind: 'event',
          category: 'school',
          type: 'school',
          title: 'CS 311',
          fullTitle: 'Automata Theory and Formal Languages',
          location: 'Online',
          date: '2025-12-06',
          startDate: '2025-12-06',
          startTime: '15:00',
          endDate: '2025-12-06',
          endTime: '16:30',
          priority: 'medium',
          reminder: '30m',
          completed: false
        },
        {
          id: 8,
          kind: 'task',
          category: 'school',
          type: 'school',
          title: 'Submit IT 321 report',
          fullTitle: 'Submit final report for HCI',
          location: 'Online',
          date: '2025-12-05',
          startDate: '2025-12-05',
          dueDate: '2025-12-05',
          startTime: '23:59',
          priority: 'high',
          reminder: '1d',
          completed: false
        },
        {
          id: 3,
          kind: 'event',
          category: 'personal',
          type: 'personal',
          title: 'Dental Appointment',
          fullTitle: 'Regular checkup',
          location: 'Dental Clinic',
          date: '2025-12-07',
          startDate: '2025-12-07',
          startTime: '14:00',
          endDate: '2025-12-07',
          endTime: '15:00',
          priority: 'medium',
          reminder: '1d',
          completed: false
        },
        {
          id: 4,
          kind: 'event',
          category: 'work',
          type: 'work',
          title: 'Team Meeting',
          fullTitle: 'Weekly sync meeting',
          location: 'Office',
          date: '2025-12-08',
          startDate: '2025-12-08',
          startTime: '10:00',
          endDate: '2025-12-08',
          endTime: '11:00',
          priority: 'high',
          reminder: '30m',
          completed: false
        }
      ],
      conflicts: [],

      formatDate(dateString) {
        const d = new Date(dateString);
        const options = { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' };
        return d.toLocaleDateString('en-US', options);
      },

      getFirstDayOfMonth(year, month) {
        return new Date(year, month, 1).getDay();
      },

      getDaysInMonth(year, month) {
        return new Date(year, month + 1, 0).getDate();
      },

      getEventsByDate(dateString) {
        return this.events.filter(e => (e.date || e.startDate) === dateString);
      },

      hasConflict(dateString) {
        const events = this.getEventsByDate(dateString);
        if (events.length < 2) return false;
        
        for (let i = 0; i < events.length; i++) {
          for (let j = i + 1; j < events.length; j++) {
            const e1Start = this.parseTime(events[i].startTime);
            const e1End = this.parseTime(events[i].endTime);
            const e2Start = this.parseTime(events[j].startTime);
            const e2End = this.parseTime(events[j].endTime);
            
            if ((e1Start < e2End && e1End > e2Start)) {
              return true;
            }
          }
        }
        return false;
      },

      parseTime(timeStr) {
        if (!timeStr) return 0;
        const [h, m] = timeStr.split(':').map(Number);
        return h * 60 + m;
      },

      getCategoriesForDate(dateString) {
        const events = this.getEventsByDate(dateString);
        const categories = new Set(events.map(e => e.category));
        return Array.from(categories);
      },

      getWeekNumber(date) {
        const d = new Date(date);
        d.setHours(0, 0, 0, 0);
        d.setDate(d.getDate() + 4 - (d.getDay() || 7));
        const yearStart = new Date(d.getFullYear(), 0, 1);
        return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
      }
    };

    window.addEventListener('DOMContentLoaded', () => {
      populateYearSelect();
      initializeWeekView();
      renderPage();
    });

    function populateYearSelect() {
      const yearSelect = document.getElementById('yearSelect');
      const currentYear = new Date().getFullYear();
      for (let year = currentYear - 10; year <= currentYear + 10; year++) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        yearSelect.appendChild(option);
      }
    }

    function initializeWeekView() {
      const today = new Date();
      const dayOfWeek = today.getDay();
      currentWeekStart = new Date(today);
      currentWeekStart.setDate(today.getDate() - dayOfWeek);
      currentWeekStart.setHours(0, 0, 0, 0);
    }

    function switchView(mode) {
      viewMode = mode;
      document.getElementById('monthViewBtn').classList.toggle('active', mode === 'month');
      document.getElementById('weekViewBtn').classList.toggle('active', mode === 'week');
      
      if (mode === 'week') {
        initializeWeekView();
      }
      
      renderCalendar();
      renderSchedule();
    }

    function changeView(delta) {
      if (viewMode === 'month') {
        currentMonth += delta;
        if (currentMonth < 0) {
          currentMonth = 11;
          currentYear--;
        } else if (currentMonth > 11) {
          currentMonth = 0;
          currentYear++;
        }
      } else {
        currentWeekStart.setDate(currentWeekStart.getDate() + (delta * 7));
      }
      renderCalendar();
      renderSchedule();
    }

    function openMonthPicker() {
      if (viewMode === 'week') return;
      document.getElementById('monthSelect').value = currentMonth;
      document.getElementById('yearSelect').value = currentYear;
      document.getElementById('pickerModal').classList.add('active');
    }

    function closeMonthPicker() {
      document.getElementById('pickerModal').classList.remove('active');
    }

    function confirmMonthPicker() {
      currentMonth = parseInt(document.getElementById('monthSelect').value);
      currentYear = parseInt(document.getElementById('yearSelect').value);
      closeMonthPicker();
      renderCalendar();
      renderSchedule();
    }

    function renderPage() {
      renderHeader();
      renderCalendar();
      renderSchedule();
      renderNotifications();
    }

    function renderHeader() {
      const hasConflicts = AppData.conflicts && AppData.conflicts.length > 0;
      document.getElementById('notificationDot').style.display = hasConflicts ? 'block' : 'none';
    }

    function renderCalendar() {
      const daysContainer = document.getElementById('calendarDays');
      daysContainer.innerHTML = '';
      
      if (viewMode === 'month') {
        renderMonthView(daysContainer);
      } else {
        renderWeekView(daysContainer);
      }
    }

    function renderMonthView(daysContainer) {
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'];
      document.getElementById('viewLabel').textContent = `${monthNames[currentMonth]} ${currentYear}`;

      const firstDay = AppData.getFirstDayOfMonth(currentYear, currentMonth);
      const daysInMonth = AppData.getDaysInMonth(currentYear, currentMonth);

      for (let i = 0; i < firstDay; i++) {
        daysContainer.innerHTML += '<div class="day"></div>';
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(currentYear, currentMonth, day);
        const dateString = date.toISOString().split('T')[0];
        let classes = 'day';
        
        if (date.toDateString() === new Date().toDateString()) {
          classes += ' today';
        }
        
        const categories = AppData.getCategoriesForDate(dateString);
        const hasConflict = AppData.hasConflict(dateString);
        
        if (hasConflict) {
          classes += ' conflict';
        } else if (categories.length > 0) {
          if (categories.length === 1) {
            classes += ` ${categories[0]}-only`;
          } else if (categories.length === 2) {
            classes += ` ${categories.sort().join('-')}`;
          } else if (categories.length === 3) {
            classes += ' all-categories';
          }
        }
        
        daysContainer.innerHTML += `<div class="${classes}">${day}</div>`;
      }
    }

    function renderWeekView(daysContainer) {
      const weekEnd = new Date(currentWeekStart);
      weekEnd.setDate(currentWeekStart.getDate() + 6);
      
      const weekNum = AppData.getWeekNumber(currentWeekStart);
      const year = currentWeekStart.getFullYear();
      document.getElementById('viewLabel').textContent = `Week ${weekNum}, ${year}`;

      for (let i = 0; i < 7; i++) {
        const date = new Date(currentWeekStart);
        date.setDate(currentWeekStart.getDate() + i);
        const dateString = date.toISOString().split('T')[0];
        let classes = 'day';
        
        if (date.toDateString() === new Date().toDateString()) {
          classes += ' today';
        }
        
        const categories = AppData.getCategoriesForDate(dateString);
        const hasConflict = AppData.hasConflict(dateString);
        
        if (hasConflict) {
          classes += ' conflict';
        } else if (categories.length > 0) {
          if (categories.length === 1) {
            classes += ` ${categories[0]}-only`;
          } else if (categories.length === 2) {
            classes += ` ${categories.sort().join('-')}`;
          } else if (categories.length === 3) {
            classes += ' all-categories';
          }
        }
        
        daysContainer.innerHTML += `<div class="${classes}">${date.getDate()}</div>`;
      }
    }

    function renderSchedule() {
      const container = document.getElementById('scheduleList');
      const title = document.getElementById('scheduleTitle');
      container.innerHTML = '';
      
      let events;
      if (viewMode === 'month') {
        title.textContent = "This Month's Schedule";
        events = AppData.events.filter(event => {
          const eventDate = new Date(event.date || event.startDate);
          return eventDate.getFullYear() === currentYear && eventDate.getMonth() === currentMonth;
        });
      } else {
        title.textContent = "This Week's Schedule";
        const weekEnd = new Date(currentWeekStart);
        weekEnd.setDate(currentWeekStart.getDate() + 6);
        weekEnd.setHours(23, 59, 59, 999);
        
        events = AppData.events.filter(event => {
          const eventDate = new Date(event.date || event.startDate);
          return eventDate >= currentWeekStart && eventDate <= weekEnd;
        });
      }

      if (events.length === 0) {
        container.innerHTML = `<p class="no-events">No events scheduled for this ${viewMode}.</p>`;
        return;
      }
      
      events.sort((a, b) => new Date(a.date || a.startDate) - new Date(b.date || b.startDate));

      events.forEach(event => {
        const indicatorColor = event.type === 'personal' ? '#9b59b6' : 
                               event.type === 'work' ? '#1d9a66' : '#4a9eff';
        const typeIcon = event.type === 'school' ? 'fa-graduation-cap' : 
                        event.type === 'personal' ? 'fa-user' : 'fa-briefcase';
        
        const eventDate = new Date(event.date || event.startDate);
        const formattedDate = eventDate.toLocaleDateString('en-US', { 
          month: 'short', 
          day: 'numeric' 
        });
        
        container.innerHTML += `
          <div class="event-item ${event.type}">
            <div class="event-header">
              <div class="event-title">
                <div class="event-indicator" style="background: ${indicatorColor};"></div>
                <h3>${event.title}</h3>
              </div>
              <div class="event-badge ${event.type}">${formattedDate}</div>
            </div>
            <div class="event-details">
              <p>${event.fullTitle}</p>
              <p><i class="fas ${typeIcon}"></i> ${event.location}</p>
              <p class="event-time"><i class="far fa-clock"></i> ${event.startTime} - ${event.endTime || event.startTime}</p>
            </div>
          </div>`;
      });
    }

    function renderNotifications() {
      const container = document.getElementById('notificationList');
      const conflicts = AppData.conflicts || [];
      container.innerHTML = '';

      if (conflicts.length === 0) {
        container.innerHTML = '<div class="notification-item">No new notifications</div>';
        return;
      }

      conflicts.forEach(conflict => {
        container.innerHTML += `
          <div class="notification-item unread">
            <strong>${conflict.title}</strong><br>
            <small>${conflict.description}</small>
          </div>
        `;
      });
    }

    function toggleNotifications() {
      document.getElementById('notificationPanel').classList.toggle('active');
    }

    document.addEventListener('click', function(e) {
      const panel = document.getElementById('notificationPanel');
      const notifBtn = document.querySelector('.notification-btn');
      const pickerModal = document.getElementById('pickerModal');
      
      if (panel.classList.contains('active') && 
          !panel.contains(e.target) && 
          !notifBtn.contains(e.target)) {
        panel.classList.remove('active');
      }

      if (pickerModal.classList.contains('active') && 
          e.target === pickerModal) {
        closeMonthPicker();
      }
    });

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeMonthPicker();
      }
    });
  </script>
</body>
</html>