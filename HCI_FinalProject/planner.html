<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PlanEase - Planner (v13)</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  /* ----- Reset & base ----- */
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;width:100%}
  body{
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg,#1e3c72 0%,#2a5298 50%,#7e22ce 100%);
    background-attachment: fixed;
    color:#fff;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    min-height: 100vh;
  }
  /* Scrollbar styling */
  ::-webkit-scrollbar{
    width:10px;
  }
  ::-webkit-scrollbar-track{
    background:rgba(0,0,0,0.2);
    margin-top:72px;
  }
  ::-webkit-scrollbar-thumb{
    background:linear-gradient(135deg,#4a9eff,#7e22ce);
    border-radius:10px;
  }
  ::-webkit-scrollbar-thumb:hover{
    background:linear-gradient(135deg,#6ab5ff,#9d4edd);
  }

  /* Fullscreen container (100% left-right) */
  .app-container{
    width:100%;
    height:100vh;
    padding-top:80px; /* top header space */
    padding-bottom:80px; /* bottom nav space */
    background: rgba(0,0,0,0.15);
    position:relative;
    display:flex;
    flex-direction:column;
    overflow:hidden;
  }

  /* Header */
  .header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:14px 28px;
    background: rgba(0,0,0,0.22);
    backdrop-filter: blur(8px);
    position:fixed;
    top:0;
    left:0;
    right:0;
    height:80px;
    z-index:1000;
  }
  .logo{display:flex;align-items:center;gap:12px}
  .logo-img{width:48px;height:48px;border-radius:10px;overflow:hidden}
  .logo-img img{width:100%;height:100%;object-fit:cover}
  .logo-text h1{font-size:18px;letter-spacing:1px}
  .logo-text p{font-size:11px;opacity:.85}

  .header-right{display:flex;gap:12px;align-items:center}
  .notification-btn{position:relative;cursor:pointer;padding:8px;font-size:18px}
  .notification-dot{position:absolute;top:6px;right:6px;width:8px;height:8px;background:#ff4444;border-radius:50%}
  .profile-icon{position:relative;width:40px;height:40px;border-radius:50%;overflow:visible;border:1px solid rgba(255,255,255,0.15);cursor:pointer}
  .profile-icon img{width:100%;height:100%;object-fit:cover;border-radius:50%}
  .profile-tooltip{position:absolute;bottom:-85px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.95);padding:12px 14px;border-radius:8px;font-size:12px;opacity:0;pointer-events:none;transition:opacity 0.2s;z-index:9999;text-align:center;min-width:150px;white-space:normal}
  .profile-tooltip-name{font-weight:700;margin-bottom:6px}
  .profile-tooltip-email{opacity:0.85;font-size:11px;line-height:1.3}
  .profile-icon:hover .profile-tooltip{opacity:1;pointer-events:auto}

  /* Notification panel */
  .notification-panel{
    position:fixed;top:80px;right:28px;width:360px;max-width:90%;
    background:rgba(30,30,60,0.95);padding:16px;border-radius:12px;z-index:1200;display:none;
    box-shadow:0 10px 40px rgba(0,0,0,0.6);
    max-height:calc(100vh - 160px);
    overflow-y:auto;
  }
  .notification-panel.active{display:block}
  .notification-panel h3{font-size:16px;margin-bottom:10px;display:flex;gap:8px;align-items:center}

  .notification-item{background:rgba(255,255,255,0.06);padding:10px;border-radius:8px;margin-bottom:8px;border-left:3px solid #4a9eff}
  .notification-item.unread{background:rgba(74,158,255,0.12);border-left-color:#ff9d00}
  .notification-item.overdue{background:rgba(255,50,50,0.15);border-left-color:#ff2020}
  .notification-item.today{background:rgba(255,165,0,0.15);border-left-color:#ff9d00}
  .notification-item.current{background:rgba(50,200,50,0.15);border-left-color:#00dd00}

  /* Content */
  .content{
    padding:18px 28px;
    display:flex;
    flex-direction:column;
    flex:1;
    overflow:hidden;
  }
  .planner-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;gap:12px}
  .planner-header h1{font-size:28px}
  .add-btn{
    display:inline-flex;align-items:center;gap:10px;background:linear-gradient(135deg,#3b82f6,#1d9a66);border:none;padding:10px 16px;border-radius:999px;color:#fff;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.28)
  }
  .add-btn i.fa-calendar-alt{font-size:16px}
  .add-btn i.fa-plus{font-size:14px}
  .add-btn i.fa-upload{font-size:14px}

  /* Filters area */
  .planner-filters{display:flex;flex-direction:column;gap:12px;margin-bottom:18px}
  @media(min-width:640px){.planner-filters{flex-direction:row;align-items:center;justify-content:space-between}}
  .filter-dropdown{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.08);padding:10px 14px;border-radius:20px;color:#fff;cursor:pointer;font-weight:700}
  .filter-dropdown option{background:#1a1a2e;color:#fff}
  .sort-dropdown{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.08);padding:8px 12px;border-radius:20px;color:#fff}
  .sort-dropdown option{background:#1a1a2e;color:#fff}
  .sort-dropdown:disabled{opacity:.6}

  /* Planner list */
  .planner-list{
    display:grid;
    grid-template-columns:1fr;
    gap:16px;
    overflow-y:auto;
    overflow-x:hidden;
    flex:1;
    padding-right:8px;
    height:100%;
  }
  @media(min-width:768px){.planner-list{grid-template-columns:repeat(2,1fr)}}
  @media(min-width:1200px){.planner-list{grid-template-columns:repeat(3,1fr)}}

  .event-item{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.12));padding:18px;border-radius:14px;border-left:6px solid #4a9eff;transition:all .25s;box-shadow:0 6px 18px rgba(0,0,0,0.25)}
  .event-item:hover{transform:translateY(-6px)}
  .event-item.personal{border-left-color:#9b59b6}
  .event-item.work{border-left-color:#1d9a66}
  .event-title{display:flex;align-items:center;gap:10px}
  .event-indicator{width:12px;height:12px;border-radius:50%}
  .event-header{display:flex;justify-content:space-between;align-items:start;margin-bottom:10px}
  .event-badge{padding:6px 12px;border-radius:14px;font-weight:800;font-size:12px}
  .event-badge.ending-soon{background:rgba(255,68,68,0.9)}
  .event-badge.tomorrow{background:rgba(255,157,0,0.9)}
  .event-badge.dayname{background:rgba(76,175,80,0.9)}

  .event-details p{font-size:14px;opacity:.95;margin:6px 0;display:flex;gap:10px;align-items:center}
  .event-time{margin-top:8px;padding-top:8px;border-top:1px solid rgba(255,255,255,0.04)}

  .event-actions{display:flex;gap:8px;margin-top:10px}
  .action-btn{flex:1;padding:10px;border-radius:10px;border:none;cursor:pointer;font-weight:700;display:inline-flex;align-items:center;justify-content:center;gap:8px}
  .action-btn.edit{background:rgba(74,158,255,0.12);color:#4a9eff}
  .action-btn.delete{background:rgba(255,68,68,0.08);color:#ff6b6b}

  /* Completed style */
  .event-item.completed{opacity:.65;text-decoration:line-through}

  /* Bottom nav */
  .bottom-nav{position:fixed;bottom:0;left:0;width:100%;background:rgba(12,12,30,0.95);display:flex;justify-content:space-around;padding:10px 0;border-top:1px solid rgba(255,255,255,0.04);z-index:1000}
  .nav-item{display:flex;flex-direction:column;align-items:center;color:rgba(255,255,255,0.6);text-decoration:none;font-size:12px}
  .nav-item.active{color:#4a9eff}
  .nav-icon{font-size:20px}

  /* Delete modal (confirm) */
  .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:1400;opacity:0;pointer-events:none;transition:all .18s}
  .modal.active{opacity:1;pointer-events:all}
  .modal-content{background:linear-gradient(135deg,#2a3f5f,#1e3c72);padding:20px;border-radius:12px;max-width:420px;width:92%;text-align:center}

  /* Add/Edit Overlay Form (full screen modal) */
  .overlay{
    position:fixed;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0.6),rgba(0,0,0,0.65));display:none;align-items:center;justify-content:center;padding:24px;z-index:2000;
  }
  .overlay.active{display:flex}
  .overlay-panel{
    width:100%;max-width:980px;background:linear-gradient(180deg,#14233f,#0f1b2f);border-radius:14px;padding:18px;box-shadow:0 20px 60px rgba(0,0,0,0.6);overflow:auto;max-height:92vh;color:#fff;
  }
  .overlay-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
  .overlay-header h2{font-size:20px}
  .close-overlay{background:transparent;border:none;color:#fff;font-size:20px;cursor:pointer}

  .form-grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:820px){.form-grid{grid-template-columns:1fr 320px}}

  label{display:block;font-size:13px;margin-bottom:6px;opacity:.9}
  input[type="text"],input[type="date"],input[type="time"],select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.03);color:#fff}
  select option{background:#1a1a2e;color:#fff;padding:8px}
  select optgroup{background:#1a1a2e;color:#fff}
  textarea{min-height:90px;resize:vertical}
  .row{display:flex;gap:8px}
  .row > *{flex:1}

  .small{font-size:13px;opacity:.9}

  .form-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
  .btn{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:800}
  .btn.primary{background:#1d9a66;color:#fff}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);color:#fff}

  .muted{opacity:.85;font-size:13px}

  /* small helpers */
  .badge-inline{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.04);font-weight:700}

  /* tiny responsiveness adjustments */
  @media(max-width:420px){
    .overlay-panel{padding:14px}
    .planner-header h1{font-size:22px}
    .add-btn{padding:8px 10px}
    .event-title h3{font-size:16px}
  }
</style>
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <div class="header">
      <div class="logo">
        <div class="logo-img"><img src="assets/logo.png" alt="PlanEase Logo"></div>
        <div class="logo-text">
          <h1>PLAN EASE</h1>
          <p>Plan with Ease</p>
        </div>
      </div>

      <div class="header-right">
        <div class="notification-btn" id="notifBtn" title="Notifications">
          <i class="fas fa-list"></i>
          <div class="notification-dot"></div>
        </div>
        <div class="profile-icon" id="profileIcon">
          <img src="assets/profile_pic.png" alt="Profile">
          <div class="profile-tooltip">
            <div class="profile-tooltip-name">Damian Alvah</div>
            <div class="profile-tooltip-email">dalvah@gmail.com</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Notification panel -->
    <div class="notification-panel" id="notificationPanel">
      <h3><i class="fas fa-list"></i> Today & Upcoming</h3>
      <div id="notificationList"><!-- JS fills --></div>
    </div>

    <!-- Content -->
    <div class="content">
      <div class="planner-header">
        <h1>Planner</h1>
        <div style="display:flex;gap:10px">
          <button class="add-btn" id="openAdd">
            <i class="fa-solid fa-calendar-days fa-calendar-alt"></i>
            <i class="fas fa-plus"></i>
            <span>Add</span>
          </button>
          <button class="add-btn" id="importBtn" title="Import semester schedule">
            <i class="fas fa-upload"></i>
            <span>Import</span>
          </button>
        </div>
      </div>

      <div class="planner-filters">
        <select class="filter-dropdown" id="filterSelect">
          <optgroup label="All Items">
            <option value="all" selected>All</option>
            <option value="all-tasks">All Tasks</option>
            <option value="all-events">All Events</option>
          </optgroup>
          <optgroup label="Current">
            <option value="current">Current</option>
            <option value="current-tasks">Current Tasks</option>
            <option value="current-events">Current Events</option>
          </optgroup>
          <optgroup label="Missed">
            <option value="missed">Missed</option>
            <option value="missed-tasks">Missed Tasks</option>
            <option value="missed-events">Missed Events</option>
          </optgroup>
          <optgroup label="Completed">
            <option value="completed">Completed</option>
            <option value="completed-tasks">Completed Tasks</option>
            <option value="completed-events">Completed Events</option>
          </optgroup>
        </select>
      </div>

      <div class="planner-list" id="plannerList">
        <!-- populated by JS -->
      </div>
    </div>

    <!-- bottom nav -->
    <div class="bottom-nav">
      <a href="home.html" class="nav-item"><div class="nav-icon"><i class="fas fa-home"></i></div><div>Home</div></a>
      <a href="calendar.html" class="nav-item"><div class="nav-icon"><i class="far fa-calendar-alt"></i></div><div>Calendar</div></a>
      <a href="planner.html" class="nav-item active"><div class="nav-icon"><i class="fas fa-book"></i></div><div>Planner</div></a>
      <a href="account.html" class="nav-item"><div class="nav-icon"><i class="far fa-user"></i></div><div>Account</div></a>
    </div>
  </div>

  <!-- Hidden file input for import -->
  <input type="file" id="importFile" accept=".json,.csv" style="display:none">

  <!-- Import modal -->
  <div class="modal" id="importModal">
    <div class="modal-content">
      <div style="font-size:36px;color:#4a9eff;margin-bottom:8px"><i class="fas fa-upload"></i></div>
      <h2 style="margin-bottom:14px;font-size:20px">Import Schedule</h2>
      <div style="margin-bottom:14px;font-size:14px;opacity:0.9">
        <p style="margin-bottom:10px">Upload a JSON or CSV file with your semester schedule.</p>
        <p style="font-size:12px;opacity:0.7;margin-bottom:10px"><strong>JSON Format:</strong></p>
        <code style="background:rgba(0,0,0,0.3);padding:8px;border-radius:4px;display:block;font-size:11px;margin-bottom:10px;overflow-x:auto">[{"title":"IT 321","fullTitle":"HCI","category":"school","kind":"event","startDate":"2025-12-06","startTime":"10:00","endDate":"2025-12-06","endTime":"13:30","location":"Online"}]</code>
        <p style="font-size:12px;opacity:0.7"><strong>CSV Format:</strong> title,fullTitle,category,kind,startDate,startTime,endDate,endTime,location</p>
      </div>
      <div style="display:flex;gap:8px;justify-content:center">
        <button class="btn ghost" id="cancelImport">Cancel</button>
        <button class="btn primary" id="selectImportFile">Choose File</button>
      </div>
    </div>
  </div>
  <div class="modal" id="deleteModal">
    <div class="modal-content">
      <div style="font-size:36px;color:#ff6b6b;margin-bottom:8px"><i class="fas fa-exclamation-triangle"></i></div>
      <div style="margin-bottom:14px">Are you sure you want to delete this item? This cannot be undone.</div>
      <div style="display:flex;gap:8px;justify-content:center">
        <button class="btn ghost" id="cancelDelete">Cancel</button>
        <button class="btn primary" id="confirmDelete">Delete</button>
      </div>
    </div>
  </div>

  <!-- Add/Edit overlay -->
  <div class="overlay" id="overlay">
    <div class="overlay-panel" role="dialog" aria-modal="true">
      <div class="overlay-header">
        <h2 id="overlayTitle">Add item</h2>
        <button class="close-overlay" id="closeOverlay" title="Close"><i class="fas fa-times"></i></button>
      </div>

      <form id="itemForm" class="form-grid">
        <div>
          <label>Type</label>
          <div style="display:flex;gap:8px;margin-bottom:10px">
            <button type="button" class="btnType btn ghost" data-type="event">Event</button>
            <button type="button" class="btnType btn ghost" data-type="task">Task</button>
          </div>

          <label for="title">Title <span class="small" style="opacity:.8"> (required)</span></label>
          <input id="title" name="title" type="text" required placeholder="e.g. IT 321 - HCI" />

          <label for="description">Description</label>
          <textarea id="description" name="description" placeholder="Add a subtle description (optional)"></textarea>

          <label for="category">Category / Tag</label>
          <select id="category" name="category">
            <option value="school">School</option>
            <option value="work">Work</option>
            <option value="personal">Personal</option>
          </select>

          <label for="priority" id="priorityLabel">Priority (Tasks only)</label>
          <select id="priority" name="priority">
            <option value="low">Low</option>
            <option value="medium" selected>Medium</option>
            <option value="high">High</option>
            <option value="urgent">Urgent</option>
          </select>

          <label style="margin-top:8px">Reminders / Alarms</label>
          <select id="reminder">
            <option value="none">No reminder</option>
            <option value="at_time">At time</option>
            <option value="5m">5 minutes before</option>
            <option value="10m">10 minutes before</option>
            <option value="30m">30 minutes before</option>
            <option value="1h">1 hour before</option>
            <option value="1d">1 day before</option>
          </select>

          <label style="margin-top:8px">Repeat</label>
          <select id="repeat">
            <option value="none">None</option>
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="biweekly">Bi-weekly</option>
            <option value="monthly">Monthly</option>
          </select>

          <label style="margin-top:8px">Attachments (optional)</label>
          <input type="file" id="attachment" />

        </div>

        <aside>
          <label>Dates & Time</label>
          <div style="margin-bottom:8px">
            <label style="display:flex;gap:8px;align-items:center"><input type="checkbox" id="bulkToggle"> <span class="small">Create full semester schedule</span></label>
          </div>

          <div id="bulkOptions" style="display:none;border:1px solid rgba(255,255,255,0.04);padding:10px;border-radius:8px;margin-bottom:10px">
            <div style="margin-bottom:8px"><strong>Semester range</strong></div>
            <div class="row" style="margin-bottom:8px">
              <input type="date" id="semStart" />
              <input type="date" id="semEnd" />
            </div>

            <div style="margin-bottom:8px"><strong>Week template A (week 1)</strong></div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:8px">
              <div>Mon: <select id="weekA_mon"><option value="none">None</option><option value="f2f">F2F</option><option value="online">Online</option></select></div>
              <div>Tue: <select id="weekA_tue"><option value="none">None</option><option value="f2f">F2F</option><option value="online">Online</option></select></div>
              <div>Wed: <select id="weekA_wed"><option value="none">None</option><option value="f2f">F2F</option><option value="online">Online</option></select></div>
              <div>Thu: <select id="weekA_thu"><option value="none">None</option><option value="f2f">F2F</option><option value="online">Online</option></select></div>
              <div>Fri: <select id="weekA_fri"><option value="none">None</option><option value="f2f">F2F</option><option value="online">Online</option></select></div>
            </div>

            <div style="margin-bottom:8px"><strong>Week template B (week 2)</strong></div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px">
              <div>Mon: <select id="weekB_mon"><option value="none">None</option><option value="f2f">F2F</option><option value="online">Online</option></select></div>
              <div>Tue: <select id="weekB_tue"><option value="none">None</option><option value="f2f">F2F</option><option value="online">Online</option></select></div>
              <div>Wed: <select id="weekB_wed"><option value="none">None</option><option value="f2f">F2F</option><option value="online">Online</option></select></div>
              <div>Thu: <select id="weekB_thu"><option value="none">None</option><option value="f2f">F2F</option><option value="online">Online</option></select></div>
              <div>Fri: <select id="weekB_fri"><option value="none">None</option><option value="f2f">F2F</option><option value="online">Online</option></select></div>
            </div>
          </div>

          <div class="row">
            <input type="date" id="startDate" />
            <input type="time" id="startTime" />
          </div>
          <div class="row" style="margin-top:8px">
            <input type="date" id="endDate" />
            <input type="time" id="endTime" />
          </div>
          <div style="margin-top:8px">
            <label class="row"><input type="checkbox" id="allDay" /> <span class="small">All-day</span></label>
          </div>

          <label style="margin-top:10px">Delivery Mode</label>
          <select id="mode">
            <option value="online">Online</option>
            <option value="f2f">Face-to-Face (F2F)</option>
            <option value="hybrid">Hybrid</option>
          </select>

          <div id="modeFields" style="margin-top:8px"></div>

          <div style="margin-top:14px;display:flex;gap:8px;align-items:center">
            <label class="small">Mark as completed</label>
            <input type="checkbox" id="completedFlag" />
          </div>

          <div class="form-actions" style="margin-top:20px">
            <button type="button" class="btn ghost" id="cancelForm">Cancel</button>
            <button type="submit" class="btn primary" id="saveForm">Save</button>
          </div>
        </aside>
      </form>
    </div>
  </div>

<script>
/* =========================
   Hardcoded initial data
   ========================= */
let events = [
  {
    id: 1,
    kind: 'event', // 'event' or 'task'
    category: 'school',
    type: 'school',
    title: 'IT 321',
    fullTitle: 'Human-Computer Interaction',
    location: 'Online',
    startDate: '2025-12-06',
    startTime: '10:00',
    endDate: '2025-12-06',
    endTime: '13:30',
    priority: 'medium',
    reminder: '10m',
    completed: false
  },
  {
    id: 2,
    kind: 'event',
    category: 'school',
    type: 'school',
    title: 'CS 311',
    fullTitle: 'Automata Theory and Formal Languages',
    location: 'Online',
    startDate: '2025-10-23',
    startTime: '07:00',
    endDate: '2025-10-23',
    endTime: '08:30',
    priority: 'medium',
    reminder: '30m',
    completed: false
  },
  {
    id: 3,
    kind: 'event',
    category: 'school',
    type: 'school',
    title: 'GEd 104',
    fullTitle: 'The Contemporary World',
    location: 'Online',
    startDate: '2025-10-23',
    startTime: '07:00',
    endDate: '2025-10-23',
    endTime: '08:30',
    priority: 'medium',
    reminder: '30m',
    completed: false
  },
  {
    id: 4,
    kind: 'event',
    category: 'school',
    type: 'school',
    title: 'IT 314',
    fullTitle: 'Web Systems and Technologies',
    location: 'Online',
    startDate: '2025-10-23',
    startTime: '13:00',
    endDate: '2025-10-23',
    endTime: '16:00',
    priority: 'medium',
    reminder: '30m',
    completed: false
  },
  {
    id: 5,
    kind: 'event',
    category: 'school',
    type: 'school',
    title: 'IT 331',
    fullTitle: 'Application Development and Emerging Technologies',
    location: 'Online',
    startDate: '2025-10-24',
    startTime: '07:00',
    endDate: '2025-10-24',
    endTime: '10:00',
    priority: 'medium',
    reminder: '30m',
    completed: false
  },
  {
    id: 6,
    kind: 'event',
    category: 'school',
    type: 'school',
    title: 'CS 312',
    fullTitle: 'Mobile Computing',
    location: 'Online',
    startDate: '2025-10-24',
    startTime: '07:00',
    endDate: '2025-10-24',
    endTime: '08:30',
    priority: 'medium',
    reminder: '30m',
    completed: false
  },
  {
    id: 7,
    kind: 'event',
    category: 'personal',
    type: 'personal',
    title: 'Dental Appointment',
    fullTitle: 'Dental Appointment',
    location: 'Dental Clinic',
    startDate: '2025-10-24',
    startTime: '14:00',
    endDate: '2025-10-24',
    endTime: '15:00',
    priority: 'low',
    reminder: '1d',
    completed: false
  },
  // example tasks
  {
    id: 8,
    kind: 'task',
    category: 'school',
    type: 'school',
    title: 'Submit IT 321 report',
    fullTitle: 'Submit final report for HCI',
    location: 'Online',
    startDate: '2025-12-05',
    startTime: '23:59',
    endDate: '2025-12-05',
    endTime: '23:59',
    priority: 'high',
    reminder: '1d',
    completed: false
  },
  {
    id: 9,
    kind: 'task',
    category: 'personal',
    type: 'personal',
    title: 'Buy groceries',
    fullTitle: 'Groceries: milk, eggs, bread',
    location: 'Grocery Store',
    startDate: '2025-12-07',
    startTime: '10:00',
    endDate: '2025-12-07',
    endTime: '11:00',
    priority: 'low',
    reminder: 'none',
    completed: true
  }
];

/* =========================
   App state
   ========================= */
let state = {
  filter: 'all', // all | task | event | completed
  sort: 'date',
  editingId: null
}

/* =========================
   DOM helpers & render
   ========================= */

const plannerList = document.getElementById('plannerList');
const notificationPanel = document.getElementById('notificationPanel');
const notificationList = document.getElementById('notificationList');
const overlay = document.getElementById('overlay');
const overlayTitle = document.getElementById('overlayTitle');
const itemForm = document.getElementById('itemForm');
const deleteModal = document.getElementById('deleteModal');

function formatDate(dateStr){
  if(!dateStr) return '';
  const d = new Date(dateStr + 'T00:00');
  // en-GB format day/month/year
  return d.toLocaleDateString('en-GB');
}

function daysUntil(dateStr){
  const today = new Date(); today.setHours(0,0,0,0);
  const d = new Date(dateStr + 'T00:00');
  const diff = Math.ceil((d - today)/(1000*60*60*24));
  return diff;
}

function getBadgeForEvent(e){
  const diffDays = daysUntil(e.startDate);
  if(e.kind === 'event' && diffDays <= 0 && diffDays >= -1){
    return {text: 'Ends soon', cls:'ending-soon'};
  } else if(diffDays === 0){
    return {text:'Today', cls:'ending-soon'};
  } else if(diffDays === 1){
    return {text:'Tomorrow', cls:'tomorrow'};
  } else if(diffDays > 1 && diffDays <=7){
    const dayNames = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
    const dayName = new Date(e.startDate).getDay();
    return {text: dayNames[dayName], cls: 'dayname'};
  } else {
    return {text: formatDate(e.startDate), cls:'dayname'};
  }
}

function renderTodayPanel(){
  const now = new Date();
  now.setHours(0,0,0,0);
  const in7days = new Date();
  in7days.setDate(now.getDate() + 7);

  // Filter items
  const items = events.filter(ev=>{
    const start = new Date(ev.startDate + 'T00:00');
    const isToday = start.getTime() === now.getTime();
    const isOverdue = !ev.completed && start < now;
    const isUpcoming7 = start > now && start <= in7days;
    return isToday || isOverdue || isUpcoming7;
  }).sort((a,b)=> new Date(a.startDate + 'T' + (a.startTime||'00:00')) - new Date(b.startDate + 'T' + (b.startTime||'00:00')) );

  if(items.length === 0){
    notificationList.innerHTML = '<div class="notification-item">No tasks/events for today or upcoming.</div>';
    return;
  }

  notificationList.innerHTML = items.map((ev,i)=>{
    let badgeText='';
    let badgeClass='';
    const start = new Date(ev.startDate + 'T00:00');
    const diffDays = Math.ceil((start - now)/(1000*60*60*24));
    if(!ev.completed && start < now) {
      badgeText = 'Overdue';
      badgeClass = 'overdue';
    } else if(diffDays === 0) {
      badgeText = 'Today';
      badgeClass = 'today';
    } else if(diffDays === 1) {
      badgeText = 'Tomorrow';
      badgeClass = 'current';
    } else if(diffDays > 1 && diffDays <=7){
      const dayNames = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
      badgeText = dayNames[start.getDay()];
      badgeClass = 'current';
    }

    return `<div class="notification-item ${badgeClass}">
      <strong>${ev.title} ${badgeText ? '('+badgeText+')' : ''}</strong><br>
      <small>${ev.fullTitle || ''} • ${ev.startTime || '—'} - ${ev.endTime || '—'}</small>
    </div>`;
  }).join('');
}

function renderNotifications(){
  renderTodayPanel();
}

function renderPlanner(){
  // filter & sort
  let items = [...events];
  
  // Handle hierarchical filters
  const now = new Date();
  now.setHours(0,0,0,0);
  
  if(state.filter === 'all'){
    // show all items (no filter)
  } else if(state.filter === 'all-tasks'){
    items = items.filter(i => i.kind === 'task');
  } else if(state.filter === 'all-events'){
    items = items.filter(i => i.kind === 'event');
  } else if(state.filter === 'current'){
    items = items.filter(i => !i.completed);
  } else if(state.filter === 'current-tasks'){
    items = items.filter(i => !i.completed && i.kind === 'task');
  } else if(state.filter === 'current-events'){
    items = items.filter(i => !i.completed && i.kind === 'event');
  } else if(state.filter === 'missed'){
    items = items.filter(i => !i.completed && new Date(i.startDate + 'T00:00') < now);
  } else if(state.filter === 'missed-tasks'){
    items = items.filter(i => !i.completed && i.kind === 'task' && new Date(i.startDate + 'T00:00') < now);
  } else if(state.filter === 'missed-events'){
    items = items.filter(i => !i.completed && i.kind === 'event' && new Date(i.startDate + 'T00:00') < now);
  } else if(state.filter === 'completed'){
    items = items.filter(i => i.completed);
  } else if(state.filter === 'completed-tasks'){
    items = items.filter(i => i.completed && i.kind === 'task');
  } else if(state.filter === 'completed-events'){
    items = items.filter(i => i.completed && i.kind === 'event');
  }

  // Sort by completion status then by date
  items.sort((a,b)=>{
    // Incomplete items first, then completed
    if(a.completed !== b.completed) return a.completed ? 1 : -1;
    // Then sort by date
    const da = new Date((a.startDate||'1970-01-01') + 'T' + (a.startTime||'00:00'));
    const db = new Date((b.startDate||'1970-01-01') + 'T' + (b.startTime||'00:00'));
    return da - db;
  });

  // Group by month
  const grouped = {};
  items.forEach(item => {
    const date = new Date(item.startDate + 'T00:00');
    const monthKey = date.toLocaleDateString('en-GB', {month: 'long', year: 'numeric'});
    if(!grouped[monthKey]) grouped[monthKey] = [];
    grouped[monthKey].push(item);
  });

  // build HTML
  if(items.length === 0){
    plannerList.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:40px;color:rgba(255,255,255,0.5)">No items found.</div>';
    return;
  }

  let html = '';
  Object.keys(grouped).forEach(monthKey => {
    html += `<div style="grid-column:1/-1;padding:12px 0;margin-top:10px;border-bottom:1px solid rgba(255,255,255,0.1);"><h2 style="font-size:16px;opacity:0.8">${monthKey}</h2></div>`;
    grouped[monthKey].forEach(ev => {
      const badge = getBadgeForEvent(ev);
      const indicatorColor = ev.category === 'personal' ? '#9b59b6' : ev.category === 'work' ? '#1d9a66' : '#4a9eff';
      const typeIcon = ev.kind === 'task' ? 'fa-list-check' : 'fa-graduation-cap';
      const typeName = ev.kind === 'task' ? 'Task' : 'Event';
      const completedCls = ev.completed ? 'completed' : '';
      html += `<div class="event-item ${ev.category} ${completedCls}" data-id="${ev.id}">
        <div class="event-header">
          <div style="display:flex;gap:10px;align-items:center">
            <div class="event-indicator" style="background:${indicatorColor}"></div>
            <div>
              <h3 style="margin:0">${ev.title}</h3>
              <div class="muted small">${ev.fullTitle || ''}</div>
            </div>
          </div>
          <div style="text-align:right">
            <div class="event-badge ${badge.cls}" title="Date">${badge.text}</div>
          </div>
        </div>

        <div class="event-details">
          <p><i class="fas ${typeIcon}"></i> ${typeName} • <strong>${ev.category}</strong></p>
          <p><i class="fas fa-map-marker-alt"></i> ${ev.location || '—'}</p>
          <p class="event-time"><i class="far fa-calendar"></i> ${formatDate(ev.startDate)} <br><i class="far fa-clock"></i> ${ev.startTime || '—'} - ${ev.endTime || '—'}</p>
        </div>

        <div class="event-actions">
          <button class="action-btn edit" data-id="${ev.id}" title="Edit"><i class="fas fa-edit"></i> Edit</button>
          <button class="action-btn delete" data-id="${ev.id}" title="Delete"><i class="fas fa-trash"></i> Delete</button>
          <button class="action-btn" data-complete="${ev.id}" title="Toggle complete" style="background:rgba(255,255,255,0.03);color:#fff">
            <i class="fas ${ev.completed ? 'fa-check-circle' : 'fa-circle'}"></i> ${ev.completed ? 'Completed' : 'Mark'}
          </button>
        </div>
      </div>`;
    });
  });
  plannerList.innerHTML = html;

  // attach handlers (delegation)
  document.querySelectorAll('.action-btn.edit').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const id = Number(btn.dataset.id);
      openOverlay('edit', id);
    });
  });
  document.querySelectorAll('.action-btn.delete').forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const id = Number(btn.dataset.id);
      openDeleteConfirm(id);
    });
  });
  document.querySelectorAll('.event-actions [data-complete]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id = Number(btn.getAttribute('data-complete'));
      toggleComplete(id);
    });
  });
}

/* =========================
   CRUD-ish in-memory actions
   ========================= */
function nextId(){
  return Math.max(0,...events.map(e=>e.id)) + 1;
}

function addItem(payload){
  payload.id = nextId();
  events.push(payload);
  renderPlanner();
  renderNotifications();
}

function updateItem(id, payload){
  const idx = events.findIndex(e => e.id === id);
  if(idx !== -1){
    events[idx] = {...events[idx], ...payload};
    renderPlanner();
    renderNotifications();
  }
}

function deleteItem(id){
  events = events.filter(e => e.id !== id);
  closeDeleteConfirm();
  renderPlanner();
  renderNotifications();
}

function toggleComplete(id){
  const ev = events.find(e=>e.id===id);
  if(ev){
    ev.completed = !ev.completed;
    renderPlanner();
    renderNotifications();
  }
}

/* =========================
   Delete confirm modal
   ========================= */
let pendingDeleteId = null;
function openDeleteConfirm(id){
  pendingDeleteId = id;
  deleteModal.classList.add('active');
}
document.getElementById('cancelDelete').addEventListener('click', closeDeleteConfirm);
document.getElementById('confirmDelete').addEventListener('click', ()=>{ if(pendingDeleteId) deleteItem(pendingDeleteId); });
function closeDeleteConfirm(){ pendingDeleteId = null; deleteModal.classList.remove('active'); }

/* =========================
   Overlay (Add/Edit) behavior
   ========================= */
const openAddBtn = document.getElementById('openAdd');
const closeOverlayBtn = document.getElementById('closeOverlay');
const cancelFormBtn = document.getElementById('cancelForm');
const btnTypeEls = document.querySelectorAll('.btnType');

openAddBtn.addEventListener('click', ()=> openOverlay('add'));
closeOverlayBtn.addEventListener('click', closeOverlay);
cancelFormBtn.addEventListener('click', closeOverlay);

btnTypeEls.forEach(b=>{
  b.addEventListener('click', ()=>{
    btnTypeEls.forEach(x=>x.classList.remove('primary'));
    b.classList.add('primary');
    document.querySelectorAll('.btnType').forEach(btn=>btn.classList.remove('primary'));
    b.classList.add('primary');
    // also toggle priority visibility
    setFormKind(b.dataset.type);
  });
});

function openOverlay(mode='add', id=null){
  state.editingId = (mode==='edit'?id:null);
  overlay.classList.add('active');
  overlayTitle.textContent = mode === 'add' ? 'Add item' : 'Edit item';
  // reset
  itemForm.reset();
  document.querySelectorAll('.btnType').forEach(bt=>bt.classList.remove('primary'));
  // choose default by mode
  if(mode === 'add'){
    document.querySelector('.btnType[data-type="event"]').classList.add('primary');
    setFormKind('event');
    document.getElementById('priorityLabel').style.display = 'none';
    document.getElementById('priority').style.display = 'none';
    // Ensure bulk options are reset when opening add form
    const bt = document.getElementById('bulkToggle'); if(bt) bt.checked = false;
    const bo = document.getElementById('bulkOptions'); if(bo) bo.style.display = 'none';
  } else {
    // prefill values
    const ev = events.find(x=>x.id === id);
    if(!ev) return;
    const typeBtn = document.querySelector(`.btnType[data-type="${ev.kind}"]`);
    if(typeBtn) typeBtn.classList.add('primary');
    setFormKind(ev.kind);

    document.getElementById('title').value = ev.title || '';
    document.getElementById('description').value = ev.fullTitle || '';
    document.getElementById('category').value = ev.category || 'school';
    document.getElementById('priority').value = ev.priority || 'medium';
    document.getElementById('reminder').value = ev.reminder || 'none';
    document.getElementById('repeat').value = ev.repeat || 'none';
    document.getElementById('startDate').value = ev.startDate || '';
    document.getElementById('startTime').value = ev.startTime || '';
    document.getElementById('endDate').value = ev.endDate || '';
    document.getElementById('endTime').value = ev.endTime || '';
    document.getElementById('mode').value = ev.mode || 'online';
    document.getElementById('completedFlag').checked = !!ev.completed;
    renderModeFields(); // show appropriate fields
  }
}

function closeOverlay(){
  overlay.classList.remove('active');
  state.editingId = null;
}

/* form kind: show/hide priority etc */
function setFormKind(kind){
  const priorityLabel = document.getElementById('priorityLabel');
  const priorityEl = document.getElementById('priority');
  if(kind === 'task'){
    priorityLabel.style.display = 'block';
    priorityEl.style.display = 'block';
  } else {
    priorityLabel.style.display = 'none';
    priorityEl.style.display = 'none';
  }
}

/* Mode dependent fields (location vs link) */
document.getElementById('mode').addEventListener('change', renderModeFields);
function renderModeFields(){
  const mode = document.getElementById('mode').value;
  const container = document.getElementById('modeFields');
  container.innerHTML = '';
  if(mode === 'f2f'){
    container.innerHTML = `
      <label>Address</label>
      <input type="text" id="f2fAddress" placeholder="Building / Room / Full address (optional)">
      <button type="button" class="btn ghost" style="margin-top:8px" id="useSavedLocations">Use saved locations</button>
    `;
  } else if(mode === 'online'){
    container.innerHTML = `
      <label>Online link</label>
      <input type="text" id="onlineLink" placeholder="Google Meet / Zoom / Teams URL">
      <label style="margin-top:8px">Meeting password (optional)</label>
      <input type="text" id="onlinePass" placeholder="Password / code (optional)">
    `;
  } else if(mode === 'hybrid'){
    container.innerHTML = `
      <label>Address</label>
      <input type="text" id="f2fAddress" placeholder="Building / Room / Full address">
      <label style="margin-top:8px">Online link</label>
      <input type="text" id="onlineLink" placeholder="Zoom / Meet link">
    `;
  }
}

/* Save form (add or update) */
itemForm.addEventListener('submit', function(e){
  e.preventDefault();
  const kind = document.querySelector('.btnType.primary')?.dataset.type || 'event';
  const title = document.getElementById('title').value.trim();
  if(!title){ alert('Title is required'); return; }

  const isBulk = document.getElementById('bulkToggle')?.checked;

  if(!isBulk){
    const payload = {
      kind: kind,
      title: title,
      fullTitle: document.getElementById('description').value.trim(),
      category: document.getElementById('category').value,
      priority: document.getElementById('priority').value,
      reminder: document.getElementById('reminder').value,
      repeat: document.getElementById('repeat').value,
      startDate: document.getElementById('startDate').value || '',
      startTime: document.getElementById('startTime').value || '',
      endDate: document.getElementById('endDate').value || '',
      endTime: document.getElementById('endTime').value || '',
      mode: document.getElementById('mode').value || 'online',
      location: (document.getElementById('mode').value==='f2f') ? (document.getElementById('f2fAddress')?.value || '') : (document.getElementById('onlineLink')?.value || '') ,
      completed: document.getElementById('completedFlag').checked
    };

    if(state.editingId){
      updateItem(state.editingId, payload);
    } else {
      addItem(payload);
    }
    closeOverlay();
    return;
  }

  // Bulk semester schedule flow
  const semStartStr = document.getElementById('semStart')?.value;
  const semEndStr = document.getElementById('semEnd')?.value;
  if(!semStartStr || !semEndStr){ alert('Please provide semester start and end dates'); return; }
  const semStart = new Date(semStartStr + 'T00:00');
  const semEnd = new Date(semEndStr + 'T00:00');
  if(semEnd < semStart){ alert('Semester end must be after start'); return; }

  const days = ['mon','tue','wed','thu','fri'];
  const weekA = {};
  const weekB = {};
  days.forEach(d=>{
    weekA[d] = document.getElementById('weekA_'+d)?.value || 'none';
    weekB[d] = document.getElementById('weekB_'+d)?.value || 'none';
  });

  // Base payload fields used for every generated event
  const base = {
    kind: kind,
    title: title,
    fullTitle: document.getElementById('description').value.trim(),
    category: document.getElementById('category').value,
    priority: document.getElementById('priority').value,
    reminder: document.getElementById('reminder').value,
    repeat: document.getElementById('repeat').value,
    startTime: document.getElementById('startTime').value || '',
    endTime: document.getElementById('endTime').value || '',
    completed: document.getElementById('completedFlag').checked
  };

  // Safety cap to avoid extremely large imports
  const MAX_EVENTS = 500;
  let created = 0;

  // iterate date by date
  const msPerDay = 24*60*60*1000;
  let cur = new Date(semStart.getTime());
  while(cur <= semEnd){
    const dow = cur.getDay(); // 0 Sun .. 6 Sat
    if(dow >= 1 && dow <=5){
      const weekOffset = Math.floor((cur - semStart) / (7*msPerDay));
      const template = (weekOffset % 2 === 0) ? weekA : weekB;
      const dayKey = days[dow-1];
      const modeForDay = template[dayKey];
      if(modeForDay && modeForDay !== 'none'){
        const payload = Object.assign({}, base);
        payload.startDate = cur.toISOString().slice(0,10);
        payload.endDate = payload.startDate;
        payload.mode = modeForDay;
        payload.location = (modeForDay === 'f2f') ? (document.getElementById('f2fAddress')?.value || '') : (document.getElementById('onlineLink')?.value || '');

        addItem(payload);
        created++;
        if(created >= MAX_EVENTS){
          alert('Reached maximum allowed events ('+MAX_EVENTS+'). Import stopped.');
          break;
        }
      }
    }
    cur = new Date(cur.getTime() + msPerDay);
  }

  alert('Created '+created+' events for the semester.');
  closeOverlay();
});

/* =========================
   Filters & UI wiring
   ========================= */
document.getElementById('filterSelect').addEventListener('change', function(e){
  state.filter = e.target.value;
  renderPlanner();
});

/* notifications toggle */
document.getElementById('notifBtn').addEventListener('click', ()=>{
  notificationPanel.classList.toggle('active');
});

/* close notif when click outside */
document.addEventListener('click', (e)=>{
  const panel = document.getElementById('notificationPanel');
  const btn = document.getElementById('notifBtn');
  if(panel.classList.contains('active') && !panel.contains(e.target) && !btn.contains(e.target)){
    panel.classList.remove('active');
  }
});

/* Profile click redirect */
document.getElementById('profileIcon').addEventListener('click', ()=>{
  window.location.href = 'account.html';
});

/* init */
renderNotifications();
renderPlanner();
renderModeFields();

// Bulk options toggle behavior: show/hide bulkOptions
const bulkToggleEl = document.getElementById('bulkToggle');
if(bulkToggleEl){
  bulkToggleEl.addEventListener('change', (e)=>{
    const box = document.getElementById('bulkOptions');
    if(!box) return;
    box.style.display = e.target.checked ? 'block' : 'none';
  });
}

/* ========================= */
/* Import schedule functionality */
/* ========================= */
const importBtn = document.getElementById('importBtn');
const importFile = document.getElementById('importFile');
const importModal = document.getElementById('importModal');
const selectImportFileBtn = document.getElementById('selectImportFile');
const cancelImportBtn = document.getElementById('cancelImport');

importBtn.addEventListener('click', () => {
  importModal.classList.add('active');
});

selectImportFileBtn.addEventListener('click', () => {
  importFile.click();
});

cancelImportBtn.addEventListener('click', () => {
  importModal.classList.remove('active');
});

importFile.addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(event) {
    try {
      let data = [];
      
      if (file.name.endsWith('.json')) {
        data = JSON.parse(event.target.result);
      } else if (file.name.endsWith('.csv')) {
        data = parseCSV(event.target.result);
      }

      if (!Array.isArray(data) || data.length === 0) {
        alert('Invalid file format. Please provide a valid JSON or CSV file.');
        return;
      }

      let importedCount = 0;
      data.forEach(item => {
        if (item.title) {
          const payload = {
            kind: item.kind || 'event',
            title: item.title,
            fullTitle: item.fullTitle || '',
            category: item.category || 'school',
            priority: item.priority || 'medium',
            reminder: item.reminder || 'none',
            repeat: item.repeat || 'none',
            startDate: item.startDate || '',
            startTime: item.startTime || '',
            endDate: item.endDate || '',
            endTime: item.endTime || '',
            mode: item.mode || 'online',
            location: item.location || '',
            completed: item.completed || false
          };
          addItem(payload);
          importedCount++;
        }
      });

      alert(`Successfully imported ${importedCount} events!`);
      importModal.classList.remove('active');
      importFile.value = '';
    } catch (error) {
      alert('Error parsing file: ' + error.message);
    }
  };
  reader.readAsText(file);
});

function parseCSV(csvText) {
  const lines = csvText.trim().split('\n');
  if (lines.length < 2) return [];
  
  const headers = lines[0].split(',').map(h => h.trim());
  const data = [];
  
  for (let i = 1; i < lines.length; i++) {
    const values = lines[i].split(',').map(v => v.trim());
    const obj = {};
    headers.forEach((header, idx) => {
      obj[header] = values[idx] || '';
    });
    data.push(obj);
  }
  
  return data;
}

/* close overlay on ESC */
window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeOverlay(); });

</script>
</body>
</html>
