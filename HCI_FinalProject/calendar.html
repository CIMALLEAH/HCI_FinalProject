<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PlanEase - Calendar</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  <script src="data.js"></script>
  <style>
    /* Basic app chrome to match planner/home */
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;width:100%}
    body{font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;background:linear-gradient(135deg,#1e3c72 0%,#2a5298 50%,#7e22ce 100%);color:#fff;overflow:hidden}

    /* Scoped scrollbar */
    .app-container::-webkit-scrollbar{width:10px}
    .app-container::-webkit-scrollbar-track{background:rgba(0,0,0,0.2);margin-top:80px;margin-bottom:80px}
    .app-container::-webkit-scrollbar-thumb{background:linear-gradient(135deg,#4a9eff,#7e22ce);border-radius:10px}
    .app-container::-webkit-scrollbar-thumb:hover{background:linear-gradient(135deg,#6ab5ff,#9d4edd)}

    .app-container{width:100%;height:100vh;overflow:auto;-webkit-overflow-scrolling:touch;padding-top:80px;padding-bottom:80px}

    .header{position:fixed;top:0;left:0;right:0;height:80px;padding:14px 28px;display:flex;align-items:center;justify-content:space-between;background:rgba(0,0,0,0.22);backdrop-filter:blur(8px);z-index:1100}
    .logo{display:flex;align-items:center;gap:12px}
    .logo-img{width:48px;height:48px;border-radius:10px;overflow:hidden}
    .logo-img img{width:100%;height:100%;object-fit:cover}
    .logo-text h1{font-size:18px}
    .header-right{display:flex;gap:12px;align-items:center}

    .profile-icon{width:40px;height:40px;border-radius:50%;overflow:hidden;border:1px solid rgba(255,255,255,0.15);cursor:pointer;position:relative}
    .profile-icon .initials{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-weight:700}
    .profile-tooltip{position:absolute;bottom:-90px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.95);padding:10px 12px;border-radius:8px;opacity:0;pointer-events:none;transition:opacity .18s;font-size:12px;min-width:140px;text-align:center}
    .profile-icon:hover .profile-tooltip{opacity:1;pointer-events:auto}

    .content{padding:18px 28px;padding-top:8px;padding-bottom:24px}
    .planner-header h1{font-size:28px}

    .notification-panel{position:fixed;top:80px;right:28px;width:360px;max-width:90%;background:rgba(30,30,60,0.95);padding:16px;border-radius:12px;z-index:1200;box-shadow:0 10px 40px rgba(0,0,0,0.6);max-height:calc(100vh - 160px);overflow-y:auto;display:none}
    .notification-panel.active{display:block}

    .calendar-grid{background:rgba(20,20,60,0.4);border-radius:16px;padding:12px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.06)}
    .weekdays{display:flex;gap:8px;margin-bottom:8px}
    .weekday{flex:1;text-align:center;font-weight:700;opacity:0.9}
    .days{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
    .day{background:rgba(255,255,255,0.02);padding:10px;border-radius:10px;min-height:70px}
    .day.today{border:1px solid rgba(255,255,255,0.12);background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.12))}
    .day.has-events{box-shadow:inset 0 -4px 0 rgba(74,158,255,0.06)}

    .section{background:rgba(30,30,70,0.5);border-radius:24px;padding:20px 18px;margin-top:12px;border:1px solid rgba(255,255,255,0.08)}
    .planner-list{display:flex;flex-direction:column;gap:12px;max-height:320px;overflow-y:auto;padding-right:8px}
    .event-item{background:rgba(50,50,90,0.6);border-radius:20px;padding:16px;border-left:5px solid #4a9eff}

    .bottom-nav{position:fixed;bottom:0;left:0;width:100%;height:80px;background:rgba(12,12,30,0.95);display:flex;justify-content:space-around;align-items:center;border-top:1px solid rgba(255,255,255,0.04);z-index:1100}
    .nav-item{display:flex;flex-direction:column;align-items:center;color:rgba(255,255,255,0.6);text-decoration:none;font-size:12px}
    .nav-item.active{color:#4a9eff}
  </style>
</head>
<body>
  <div class="app-container">
    <div class="header">
      <div class="logo">
          <div class="logo-img"><img src="assets/logo.svg" alt="PlanEase Logo"></div>
        <div class="logo-text">
          <h1>PLAN EASE</h1>
          <p>Plan with Ease</p>
        </div>
      </div>
      <div class="header-right">
        <div class="notification-btn" onclick="toggleNotifications()">
          <i class="fas fa-list"></i>
          <div class="notification-dot" id="notificationDot"></div>
        </div>
        <div class="profile-icon" onclick="window.location.href='account.html'">
          <div class="profile-icon" id="profileIcon" title="Profile" onclick="window.location.href='account.html'">
            <div class="initials" id="profileInitial"></div>
            <div class="profile-tooltip">
              <div class="profile-tooltip-name" id="profileName">Damian Alvah</div>
              <div class="profile-tooltip-email" id="profileEmail">dalvah@gmail.com</div>
            </div>
        </div>
      </div>
    </div>

    <div class="notification-panel" id="notificationPanel">
      <h3><i class="fas fa-bell"></i> Notifications</h3>
      <div id="notificationList"></div>
    </div>

    <div class="content">
      <div class="planner-header">
        <h1>Calendar</h1>
      </div>

      <div class="month-nav">
        <button class="nav-btn" onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
        <div class="current-month" id="monthYear"></div>
        <button class="nav-btn" onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
      </div>

      <div class="calendar-grid">
        <div class="weekdays">
          <div class="weekday">Sun</div>
          <div class="weekday">Mon</div>
          <div class="weekday">Tue</div>
          <div class="weekday">Wed</div>
          <div class="weekday">Thu</div>
          <div class="weekday">Fri</div>
          <div class="weekday">Sat</div>
        </div>
        <div class="days" id="calendarDays"></div>
      </div>

      <div class="section">
        <div class="section-header">
          <h2><i class="fas fa-list-alt"></i> This Month's Schedule</h2>
        </div>
        <div class="planner-list" id="monthSchedule"></div>
      </div>
    </div>

    <div class="bottom-nav">
      <a href="home.html" class="nav-item">
        <div class="nav-icon"><i class="fas fa-home"></i></div>
        <div class="nav-label">Home</div>
      </a>
      <a href="calendar.html" class="nav-item active">
        <div class="nav-icon"><i class="far fa-calendar-alt"></i></div>
        <div class="nav-label">Calendar</div>
      </a>
      <a href="planner.html" class="nav-item">
        <div class="nav-icon"><i class="fas fa-book"></i></div>
        <div class="nav-label">Planner</div>
      </a>
      <a href="account.html" class="nav-item">
        <div class="nav-icon"><i class="far fa-user"></i></div>
        <div class="nav-label">Account</div>
      </a>
    </div>
  </div>

  <script>
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();

    window.addEventListener('DOMContentLoaded', () => {
      if (typeof AppData !== 'undefined') {
        renderPage();
      } else {
        document.querySelector('.content').innerHTML = '<p style="text-align:center; color: white;">Error: AppData is not loaded.</p>';
      }
    });

    function renderPage() {
      renderHeader();
      renderCalendar();
      renderMonthSchedule();
      renderNotifications();
    }

    function renderHeader() {
      document.getElementById('profileInitial').textContent = AppData.user.firstName.charAt(0);
      // populate tooltip info
      const nameEl = document.getElementById('profileName'); if (nameEl) nameEl.textContent = AppData.user.firstName + ' ' + (AppData.user.lastName||'');
      const emailEl = document.getElementById('profileEmail'); if (emailEl) emailEl.textContent = AppData.user.email || '';
      const hasConflicts = AppData.conflicts && AppData.conflicts.length > 0;
      document.getElementById('notificationDot').style.display = hasConflicts ? 'block' : 'none';
    }

    function renderCalendar() {
      const daysContainer = document.getElementById('calendarDays');
      daysContainer.innerHTML = '';
      
      document.getElementById('monthYear').textContent = new Date(currentYear, currentMonth).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

      const firstDay = AppData.getFirstDayOfMonth(currentYear, currentMonth);
      const daysInMonth = AppData.getDaysInMonth(currentYear, currentMonth);

      for (let i = 0; i < firstDay; i++) {
        daysContainer.innerHTML += '<div class="day"></div>';
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(currentYear, currentMonth, day);
        const dateString = date.toISOString().split('T')[0];
        let classes = 'day';
        if (date.toDateString() === new Date().toDateString()) {
          classes += ' today';
        }
        if (AppData.getEventsByDate(dateString).length > 0) {
          classes += ' has-events';
        }
        if (AppData.isConflictDay(currentYear, currentMonth, day)) {
          classes += ' conflict';
        }
        daysContainer.innerHTML += `<div class="${classes}">${day}</div>`;
      }
    }

    function changeMonth(delta) {
      currentMonth += delta;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar();
      renderMonthSchedule();
    }

    function renderMonthSchedule() {
      const container = document.getElementById('monthSchedule');
      container.innerHTML = '';
      const events = AppData.events.filter(event => {
        const eventDate = new Date(event.date);
        return eventDate.getFullYear() === currentYear && eventDate.getMonth() === currentMonth;
      });

      if (events.length === 0) {
        container.innerHTML = '<p style="text-align:center; padding: 20px; color: rgba(255,255,255,0.5);">No events scheduled for this month.</p>';
        return;
      }
      
      events.sort((a,b) => new Date(a.date) - new Date(b.date));

      events.forEach(event => {
        const indicatorColor = event.type === 'personal' ? '#9b59b6' : event.type === 'work' ? '#3498db' : '#4a9eff';
        const typeIcon = event.type === 'school' ? 'fa-graduation-cap' : event.type === 'personal' ? 'fa-user' : 'fa-briefcase';
        container.innerHTML += `
          <div class="event-item ${event.type}">
            <div class="event-header">
              <div class="event-title">
                <div class="event-indicator" style="background: ${indicatorColor};"></div>
                <h3>${event.title}</h3>
              </div>
              <div class="event-badge">${AppData.formatDate(event.date)}</div>
            </div>
            <div class="event-details">
              <p>${event.fullTitle}</p>
              <p><i class="fas ${typeIcon}"></i> ${event.location}</p>
              <p class="event-time"><i class="far fa-clock"></i> ${event.startTime} - ${event.endTime}</p>
            </div>
          </div>`;
      });
    }

    function renderNotifications() {
      const container = document.getElementById('notificationList');
      const conflicts = AppData.conflicts || [];
      container.innerHTML = '';

      if (conflicts.length === 0) {
        container.innerHTML = '<div class="notification-item">No new notifications</div>';
        return;
      }

      conflicts.forEach(conflict => {
        container.innerHTML += `
          <div class="notification-item unread">
            <strong>${conflict.title}</strong><br>
            <small>${conflict.description}</small>
          </div>
        `;
      });
    }

    function toggleNotifications() {
      document.getElementById('notificationPanel').classList.toggle('active');
    }

    document.addEventListener('click', function(e) {
      const panel = document.getElementById('notificationPanel');
      const notifBtn = document.querySelector('.notification-btn');
      if (panel.classList.contains('active') && !panel.contains(e.target) && !notifBtn.contains(e.target) && !notifBtn.querySelector('i').contains(e.target)) {
        panel.classList.remove('active');
      }
    });
  </script>
</body>
</html>
